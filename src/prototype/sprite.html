<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Turbo Laps – Race Car Sprite (Canvas)</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <style>
            :root {
                --bg: #0e0f12;
                --panel: #16181d;
                --text: #e7ecef;
                --muted: #9aa4ad;
            }
            body {
                margin: 0;
                font-family: system-ui, -apple-system, Segoe UI, Roboto,
                    "Helvetica Neue", Arial, sans-serif;
                background: var(--bg);
                color: var(--text);
            }
            header {
                padding: 20px 16px 0;
            }
            .wrap {
                max-width: 960px;
                margin: 0 auto;
                padding: 16px;
            }
            .grid {
                display: grid;
                gap: 16px;
                grid-template-columns: 1fr;
            }
            @media (min-width: 900px) {
                .grid {
                    grid-template-columns: 420px 1fr;
                }
            }
            .card {
                background: var(--panel);
                border-radius: 12px;
                padding: 16px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            }
            .row {
                display: flex;
                gap: 12px;
                align-items: center;
                flex-wrap: wrap;
            }
            label {
                font-size: 13px;
                color: var(--muted);
            }
            input[type="color"],
            input[type="number"],
            input[type="range"],
            input[type="text"] {
                background: #0c0d10;
                color: var(--text);
                border: 1px solid #242833;
                border-radius: 8px;
                padding: 6px 10px;
            }
            button {
                cursor: pointer;
                border: 1px solid #2a2f3b;
                background: #1c212b;
                color: var(--text);
                padding: 10px 14px;
                border-radius: 10px;
            }
            canvas {
                width: 100%;
                height: auto;
                background: transparent;
                display: block;
            }
            .small {
                font-size: 12px;
                color: var(--muted);
            }
            .mono {
                font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
                    "Liberation Mono", monospace;
            }
            .chip {
                font-size: 12px;
                border: 1px solid #2a2f3b;
                padding: 4px 6px;
                border-radius: 8px;
                color: var(--muted);
            }
        </style>
    </head>
    <body>
        <header class="wrap">
            <h1>Race Car Sprite – HTML Canvas</h1>
            <p class="small">
                Vector-drawn car with wheels, cockpit, spoiler &amp; shadows.
                Render single sprite or export a 16-direction sprite sheet
                (PNG).
            </p>
        </header>

        <div class="wrap grid">
            <section class="card">
                <h2>Single Sprite Preview</h2>
                <div class="row">
                    <label>Body</label
                    ><input id="bodyColor" type="color" value="#e52020" />
                    <label>Accent</label
                    ><input id="accentColor" type="color" value="#ffffff" />
                    <label>Number</label
                    ><input
                        id="carNumber"
                        type="text"
                        value="7"
                        style="width: 60px"
                        maxlength="2"
                    />
                </div>
                <div class="row" style="margin-top: 8px">
                    <label>Angle</label
                    ><input
                        id="angle"
                        type="range"
                        min="0"
                        max="360"
                        value="0"
                    />
                    <span id="angleOut" class="chip">0°</span>
                    <label>Scale</label
                    ><input
                        id="scale"
                        type="number"
                        min="0.25"
                        step="0.25"
                        value="1"
                        style="width: 80px"
                    />
                </div>
                <canvas id="carCanvas" width="256" height="256"></canvas>
                <div class="row">
                    <button id="downloadSingle">Download PNG</button>
                    <span class="small"
                        >Anchor point is the center of the canvas.</span
                    >
                </div>
            </section>

            <section class="card">
                <h2>Sprite Sheet (16 directions)</h2>
                <div class="row">
                    <label>Frame Size</label
                    ><input
                        id="frameSize"
                        type="number"
                        value="96"
                        min="48"
                        step="8"
                        style="width: 90px"
                    />
                    <label>Directions</label
                    ><input
                        id="dirs"
                        type="number"
                        value="16"
                        min="4"
                        max="32"
                        step="4"
                        style="width: 80px"
                    />
                    <button id="buildSheet">Build Sheet</button>
                    <button id="downloadSheet">Download PNG</button>
                </div>
                <canvas
                    id="sheetCanvas"
                    width="1536"
                    height="96"
                    style="margin-top: 8px"
                ></canvas>
                <p class="small mono" id="atlasMeta"></p>
            </section>
        </div>

        <script>
            // ---- Drawing core -------------------------------------------------------
            function drawRaceCar(ctx, opts = {}) {
                const {
                    x = 0,
                    y = 0,
                    angle = 0,
                    scale = 1,
                    bodyColor = "#e52020",
                    accentColor = "#ffffff",
                    number = "7",
                    shadow = true,
                } = opts;

                ctx.save();
                ctx.translate(x, y);
                ctx.rotate((angle * Math.PI) / 180);
                ctx.scale(scale, scale);

                // Base proportions (designed around 80x160 body footprint)
                const w = 56; // half width footprint for drawing symmetry (car half-width)
                const L = 120; // half length from center to nose/tail (total length ~240)
                const r = 10; // general corner radius

                // Shadow ellipse
                if (shadow) {
                    ctx.save();
                    ctx.scale(1, 0.35);
                    const grad = ctx.createRadialGradient(0, 0, 10, 0, 0, 70);
                    grad.addColorStop(0, "rgba(0,0,0,0.35)");
                    grad.addColorStop(1, "rgba(0,0,0,0)");
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.ellipse(
                        0,
                        L * 0.9,
                        w * 1.2,
                        L * 0.55,
                        0,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                    ctx.restore();
                }

                // Wheels (simple rounded rectangles)
                function wheel(xc, yc, ww, hh, tilt) {
                    ctx.save();
                    ctx.translate(xc, yc);
                    ctx.rotate(tilt);
                    ctx.fillStyle = "#0c0f12";
                    roundRect(ctx, -ww / 2, -hh / 2, ww, hh, hh * 0.4);
                    ctx.fill();
                    // rim highlight
                    ctx.strokeStyle = "rgba(255,255,255,0.15)";
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.restore();
                }

                // Chassis base shape
                function chassisPath() {
                    const nose = -L,
                        tail = L;
                    const b = w;
                    ctx.beginPath();
                    // Start at front-left
                    ctx.moveTo(-b * 0.8, nose + 12);
                    ctx.quadraticCurveTo(-b, nose + 28, -b, nose + 52);
                    ctx.lineTo(-b, tail - 26);
                    ctx.quadraticCurveTo(-b, tail - 6, -b * 0.7, tail);
                    ctx.lineTo(b * 0.7, tail);
                    ctx.quadraticCurveTo(b, tail - 6, b, tail - 26);
                    ctx.lineTo(b, nose + 52);
                    ctx.quadraticCurveTo(b, nose + 28, b * 0.8, nose + 12);
                    ctx.quadraticCurveTo(0, nose - 8, -b * 0.8, nose + 12);
                }

                // Draw wheels first
                const wheelW = 22,
                    wheelH = 46;
                wheel(-w - 6, -L * 0.35, wheelH, wheelW, Math.PI / 2); // front-left
                wheel(-w - 6, L * 0.25, wheelH, wheelW, Math.PI / 2); // rear-left
                wheel(w + 6, -L * 0.35, wheelH, wheelW, Math.PI / 2); // front-right
                wheel(w + 6, L * 0.25, wheelH, wheelW, Math.PI / 2); // rear-right

                // Main body with glossy gradient
                const bodyGrad = ctx.createLinearGradient(0, -L, 0, L);
                bodyGrad.addColorStop(0.0, shade(bodyColor, -15));
                bodyGrad.addColorStop(0.45, bodyColor);
                bodyGrad.addColorStop(1.0, shade(bodyColor, -25));
                ctx.fillStyle = bodyGrad;
                chassisPath();
                ctx.fill();

                // Side pods
                ctx.fillStyle = shade(bodyColor, -25);
                roundRect(ctx, -w - 2, -L * 0.05, 10, L * 0.6, 6);
                ctx.fill();
                roundRect(ctx, w - 8, -L * 0.05, 10, L * 0.6, 6);
                ctx.fill();

                // Cockpit canopy
                const glassGrad = ctx.createLinearGradient(
                    0,
                    -L * 0.2,
                    0,
                    L * 0.3
                );
                glassGrad.addColorStop(0, "rgba(255,255,255,0.65)");
                glassGrad.addColorStop(1, "rgba(70,90,110,0.9)");
                ctx.fillStyle = glassGrad;
                roundRect(ctx, -w * 0.55, -L * 0.1, w * 1.1, L * 0.42, 18);
                ctx.fill();

                // Air intake stripe
                ctx.fillStyle = accentColor;
                roundRect(ctx, -w * 0.18, -L * 0.6, w * 0.36, L * 0.32, 8);
                ctx.fill();

                // Racing stripe (center)
                roundRect(ctx, -w * 0.12, -L * 0.75, w * 0.24, L * 1.5, 8);
                ctx.globalAlpha = 0.95;
                ctx.fillStyle = accentColor;
                ctx.fill();
                ctx.globalAlpha = 1;

                // Front splitter
                ctx.fillStyle = "#121417";
                roundRect(ctx, -w * 0.9, -L * 0.9, w * 1.8, 20, 8);
                ctx.fill();

                // Rear wing
                ctx.fillStyle = "#0f1114";
                roundRect(ctx, -w * 0.9, L * 0.78, w * 1.8, 12, 6);
                ctx.fill();
                roundRect(ctx, -w * 0.75, L * 0.7, w * 1.5, 10, 6);
                ctx.fill();

                // Number circle
                ctx.fillStyle = accentColor;
                ctx.beginPath();
                ctx.arc(0, L * 0.15, 18, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = shade(bodyColor, -55);
                ctx.font = "bold 18px system-ui, sans-serif";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(String(number).slice(0, 2), 0, L * 0.15);

                // Panel lines / details
                ctx.strokeStyle = "rgba(0,0,0,0.25)";
                ctx.lineWidth = 1.2;
                // hood line
                ctx.beginPath();
                ctx.moveTo(-w * 0.6, -L * 0.45);
                ctx.lineTo(w * 0.6, -L * 0.45);
                ctx.stroke();
                // door seams
                ctx.beginPath();
                ctx.moveTo(-w * 0.6, -L * 0.02);
                ctx.lineTo(-w * 0.6, L * 0.35);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(w * 0.6, -L * 0.02);
                ctx.lineTo(w * 0.6, L * 0.35);
                ctx.stroke();

                // Subtle highlight
                const gloss = ctx.createLinearGradient(-w, -L, w, L);
                gloss.addColorStop(0, "rgba(255,255,255,0.02)");
                gloss.addColorStop(0.5, "rgba(255,255,255,0.12)");
                gloss.addColorStop(1, "rgba(255,255,255,0.02)");
                ctx.fillStyle = gloss;
                chassisPath();
                ctx.fill();

                ctx.restore();
            }

            // Utilities
            function roundRect(ctx, x, y, w, h, r) {
                const rr = Math.min(r, w / 2, h / 2);
                ctx.beginPath();
                ctx.moveTo(x + rr, y);
                ctx.lineTo(x + w - rr, y);
                ctx.quadraticCurveTo(x + w, y, x + w, y + rr);
                ctx.lineTo(x + w, y + h - rr);
                ctx.quadraticCurveTo(x + w, y + h, x + w - rr, y + h);
                ctx.lineTo(x + rr, y + h);
                ctx.quadraticCurveTo(x, y + h, x, y + h - rr);
                ctx.lineTo(x, y + rr);
                ctx.quadraticCurveTo(x, y, x + rr, y);
                ctx.closePath();
            }
            function shade(hex, pct) {
                // simple hex shade: pct -100..100
                const c = hex.replace("#", "");
                const num = parseInt(
                    c.length === 3
                        ? c
                              .split("")
                              .map((x) => x + x)
                              .join("")
                        : c,
                    16
                );
                const r = (num >> 16) & 255,
                    g = (num >> 8) & 255,
                    b = num & 255;
                const t = pct < 0 ? 0 : 255;
                const p = Math.abs(pct) / 100;
                const R = Math.round((t - r) * p + r);
                const G = Math.round((t - g) * p + g);
                const B = Math.round((t - b) * p + b);
                return (
                    "#" +
                    [R, G, B]
                        .map((v) => v.toString(16).padStart(2, "0"))
                        .join("")
                );
            }

            // ---- Single sprite preview ---------------------------------------------
            const carCanvas = document.getElementById("carCanvas");
            const carCtx = carCanvas.getContext("2d");
            const ui = {
                body: document.getElementById("bodyColor"),
                accent: document.getElementById("accentColor"),
                angle: document.getElementById("angle"),
                scale: document.getElementById("scale"),
                number: document.getElementById("carNumber"),
                angleOut: document.getElementById("angleOut"),
            };

            function renderSingle() {
                const dpr = Math.max(1, window.devicePixelRatio || 1);
                const vw = 256,
                    vh = 256;
                // keep CSS size but increase backing store for crispness
                carCanvas.width = Math.round(vw * dpr);
                carCanvas.height = Math.round(vh * dpr);
                carCanvas.style.width = vw + "px";
                carCanvas.style.height = vh + "px";
                carCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
                carCtx.clearRect(0, 0, vw, vh);

                drawRaceCar(carCtx, {
                    x: vw / 2,
                    y: vh / 2,
                    angle: +ui.angle.value,
                    scale: +ui.scale.value,
                    bodyColor: ui.body.value,
                    accentColor: ui.accent.value,
                    number: ui.number.value,
                });
                ui.angleOut.textContent = Math.round(+ui.angle.value) + "°";
            }

            ui.body.addEventListener("input", renderSingle);
            ui.accent.addEventListener("input", renderSingle);
            ui.angle.addEventListener("input", renderSingle);
            ui.scale.addEventListener("change", renderSingle);
            ui.number.addEventListener("input", renderSingle);
            window.addEventListener("resize", renderSingle);
            renderSingle();

            // Download single
            document
                .getElementById("downloadSingle")
                .addEventListener("click", () => {
                    const link = document.createElement("a");
                    link.download = "racecar_single.png";
                    link.href = carCanvas.toDataURL("image/png");
                    link.click();
                });

            // ---- Sprite sheet builder ----------------------------------------------
            const sheetCanvas = document.getElementById("sheetCanvas");
            const sheetCtx = sheetCanvas.getContext("2d");
            const frameSizeEl = document.getElementById("frameSize");
            const dirsEl = document.getElementById("dirs");
            const atlasMeta = document.getElementById("atlasMeta");

            function buildSheet() {
                const N = Math.max(4, Math.min(32, Math.floor(+dirsEl.value)));
                const frame = Math.max(48, Math.floor(+frameSizeEl.value));
                const dpr = Math.max(1, window.devicePixelRatio || 1);

                sheetCanvas.width = Math.round(frame * N * dpr);
                sheetCanvas.height = Math.round(frame * dpr);
                sheetCanvas.style.width = frame * N + "px";
                sheetCanvas.style.height = frame + "px";
                sheetCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
                sheetCtx.clearRect(0, 0, frame * N, frame);

                const angleStep = 360 / N;
                for (let i = 0; i < N; i++) {
                    sheetCtx.save();
                    const cx = i * frame + frame / 2;
                    const cy = frame / 2;
                    // background transparency checkered
                    drawChecker(sheetCtx, i * frame, 0, frame, frame);
                    drawRaceCar(sheetCtx, {
                        x: cx,
                        y: cy,
                        angle: i * angleStep,
                        scale: frame / 200, // scales the vector car to the frame
                        bodyColor: ui.body.value,
                        accentColor: ui.accent.value,
                        number: ui.number.value,
                    });
                    sheetCtx.restore();
                }

                // metadata (for atlas import)
                const meta = {
                    frameSize: frame,
                    directions: N,
                    order: "clockwise",
                    anglesDeg: Array.from(
                        { length: N },
                        (_, i) => +(i * angleStep).toFixed(2)
                    ),
                    anchor: { x: 0.5, y: 0.5 }, // center
                };
                atlasMeta.textContent = "meta: " + JSON.stringify(meta);
            }

            function drawChecker(ctx, x, y, w, h) {
                const s = 8;
                ctx.save();
                ctx.globalAlpha = 0.8;
                for (let yy = 0; yy < h; yy += s) {
                    for (let xx = 0; xx < w; xx += s) {
                        ctx.fillStyle =
                            (xx / s + yy / s) % 2 === 0 ? "#1a1d25" : "#141820";
                        ctx.fillRect(x + xx, y + yy, s, s);
                    }
                }
                ctx.restore();
            }

            document
                .getElementById("buildSheet")
                .addEventListener("click", buildSheet);
            document
                .getElementById("downloadSheet")
                .addEventListener("click", () => {
                    const link = document.createElement("a");
                    link.download = "racecar_sheet.png";
                    link.href = sheetCanvas.toDataURL("image/png");
                    link.click();
                });

            // Build once initially
            buildSheet();
        </script>
    </body>
</html>
